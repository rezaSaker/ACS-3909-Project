<!--
 * Reza Saker Hossain
 * Gagandeep Singh
 * Niranjan Bikram Shah
-->

{% extends 'layouts/main_layout.njk' %}

{% block main_body %}
    <div id="cafe_info">
        <h3>{{ cafe.name }}</h3>
        <p>Location: {{ cafe.location }}</p>
        <p>Hours of Operation: {{ cafe.daysOpened + ' ' + cafe.startTime + ' to ' + cafe.closeTime }}</p>
        <p>Description:
            {% if cafe.description.length > 0 %}
                {{ cafe.description }}
            {% else %}
                N/A
            {% endif %}
        </p>
    </div>

    <div id="container">
        <h3>Menu</h3>
        {% for item in menu %}
            <div class="menu_item">
                <div>
                    <p>{{item.name + ' ($' + item.price + ')' }}</p>
                    {% if item.description.length > 0 %}
                        <p class="item_description">{{ item.description }}</p>
                    {% endif %}
                </div>
                <div>
                    {% if userLevel == 2 %}
                        <a href="#" class="add_to_cart_btn">Add to Cart</a>
                    {% elif userLevel == 0 %}
                        <a href="{{ '/menu/' + item._id + '/edit' }}" class="item_edit_btn">Edit</a>
                        <button class="item_delete_btn" onclick="onDeleteMenuItemBtnClick('{{ item._id }}', '{{cafe._id }}')">Delete item</button>
                         
                        
                    {% endif %}
                </div>
            </div>
        {% endfor %}

        {% if userLevel == 0 %}
            <div id="cafe_action_btns">
                <a id="item_create_btn" href="{{ '/cafe/' + cafe._id + '/createMenuItem' }}">Add New Menu Item</a>
                <a id="cafe_edit_btn" href="{{ '/cafe/' + cafe._id + '/edit' }}">Edit Cafe Info</a>
                <button id="cafe_delete_btn" onclick="onDeleteCafeBtnClick('{{ cafe._id }}')">Delete this Cafe</button>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block style %}
    #cafe_info  {
        width: 70%;
        margin: 10px 0 20px 15%;
        border-bottom: 1px solid dimgray;
        padding-bottom: 5px;
    }
    #container {
        width: 70%;
        margin-left: 15%;
        margin-bottom: 50px;
    }
    .menu_item {
        width: 100%;
        padding: 20px;
        border: 1px solid dimgray;
        border-radius: 2px;
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        margin-top: 10px;
    }
    .menu_item a {
        color: white;
        padding: 10px 15px 10px 15px;
        margin-left: 10px;
        background-color: royalblue;
        text-decoration: none;
        border-radius: 2px;
    }
    .item_description {
        font-size: 12px;
    }
    a.item_edit_btn, .item_delete_btn {
        background-color: white;
        border: 1px solid royalblue;
        color: royalblue;
    }
    a.item_edit_btn:hover {
        background-color: royalblue;
        color: white;
    }
    .item_delete_btn {
        border-color: #C3381A;
        color: #C3381A;
        font-size: 16px;
        padding-top: 10px;
        padding-bottom: 10px;
        cursor: pointer;
    }
    .item_delete_btn:hover {
        background-color: #C3381A;
        color: white;
    }
    #cafe_action_btns {
        margin-top: 50px;
    }
    #item_create_btn, #cafe_edit_btn, #cafe_delete_btn {
        color: white;
        background-color: royalblue;
        text-decoration: none;
        padding: 10px;
        border-radius: 2px;
        margin-right: 10px;
        font-size: 16px;
        cursor: pointer
    }
    #cafe_delete_btn {
        border: 1px solid #C3381A;
        color: #C3381A;
        background-color: white;
    }
    #item_create_btn:hover, 
    #cafe_edit_btn:hover, 
    a.add_to_cart_btn:hover {
        background-color: forestgreen;
    }
    #cafe_delete_btn:hover {
        background-color: #C3381A;
        color: white;
    }
{% endblock %}

{% block script %}
    {# function to make Ajax call to delete Cafe #}
    function onDeleteCafeBtnClick(cafeId) {
        let isDeleteConfirmed = confirm('This cafe and all data associated with it will be permanently deleted. ' + 
                                        'Are you sure you want to delete this cafe?');
        
        if(isDeleteConfirmed) {
            fetch('/cafe/' + cafeId + '/delete').
                then(response => {
                    if(response.status == 200) {
                        window.location.href = '/home';
                    } 
                    else {
                        alert('Sorry, couldn\'t delete the cafe info. Please try again!');
                    }
                });
        }
    }

    {# function to make Ajax call to delete an item from menu #}
    function onDeleteMenuItemBtnClick(itemId, cafeId) {
        let isDeleteConfirmed = confirm('This item will be permanently deleted. ' + 
                                        'Are you sure you want to delete this item?');
        
        if(isDeleteConfirmed) {
            fetch('/menu/' + itemId + '/delete').
                then(response => {
                    if(response.status == 200) {
                        window.location.href = '/cafe/' + cafeId;
                    } 
                    else {
                        alert('Sorry, couldn\'t delete the item. Please try again!');
                    }
                });
        }
    }
{% endblock %}
   
